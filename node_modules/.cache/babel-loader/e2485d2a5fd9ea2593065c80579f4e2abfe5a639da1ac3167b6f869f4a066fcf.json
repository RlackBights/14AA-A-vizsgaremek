{"ast":null,"code":"var Crypto = require('crypto');\nvar Events = require('events');\nvar Net = require('net');\nvar tls = require('tls');\nvar ConnectionConfig = require('./ConnectionConfig');\nvar Protocol = require('./protocol/Protocol');\nvar SqlString = require('./protocol/SqlString');\nvar Query = require('./protocol/sequences/Query');\nvar Util = require('util');\nmodule.exports = Connection;\nUtil.inherits(Connection, Events.EventEmitter);\nfunction Connection(options) {\n  Events.EventEmitter.call(this);\n  this.config = options.config;\n  this._socket = options.socket;\n  this._protocol = new Protocol({\n    config: this.config,\n    connection: this\n  });\n  this._connectCalled = false;\n  this.state = 'disconnected';\n  this.threadId = null;\n}\nConnection.createQuery = function createQuery(sql, values, callback) {\n  if (sql instanceof Query) {\n    return sql;\n  }\n  var cb = callback;\n  var options = {};\n  if (typeof sql === 'function') {\n    cb = sql;\n  } else if (typeof sql === 'object') {\n    options = Object.create(sql);\n    if (typeof values === 'function') {\n      cb = values;\n    } else if (values !== undefined) {\n      Object.defineProperty(options, 'values', {\n        value: values\n      });\n    }\n  } else {\n    options.sql = sql;\n    if (typeof values === 'function') {\n      cb = values;\n    } else if (values !== undefined) {\n      options.values = values;\n    }\n  }\n  if (cb !== undefined) {\n    cb = wrapCallbackInDomain(null, cb);\n    if (cb === undefined) {\n      throw new TypeError('argument callback must be a function when provided');\n    }\n  }\n  return new Query(options, cb);\n};\nConnection.prototype.connect = function connect(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n  if (!this._connectCalled) {\n    this._connectCalled = true;\n\n    // Connect either via a UNIX domain socket or a TCP socket.\n    this._socket = this.config.socketPath ? Net.createConnection(this.config.socketPath) : Net.createConnection(this.config.port, this.config.host);\n\n    // Connect socket to connection domain\n    if (Events.usingDomains) {\n      this._socket.domain = this.domain;\n    }\n    var connection = this;\n    this._protocol.on('data', function (data) {\n      connection._socket.write(data);\n    });\n    this._socket.on('data', wrapToDomain(connection, function (data) {\n      connection._protocol.write(data);\n    }));\n    this._protocol.on('end', function () {\n      connection._socket.end();\n    });\n    this._socket.on('end', wrapToDomain(connection, function () {\n      connection._protocol.end();\n    }));\n    this._socket.on('error', this._handleNetworkError.bind(this));\n    this._socket.on('connect', this._handleProtocolConnect.bind(this));\n    this._protocol.on('handshake', this._handleProtocolHandshake.bind(this));\n    this._protocol.on('initialize', this._handleProtocolInitialize.bind(this));\n    this._protocol.on('unhandledError', this._handleProtocolError.bind(this));\n    this._protocol.on('drain', this._handleProtocolDrain.bind(this));\n    this._protocol.on('end', this._handleProtocolEnd.bind(this));\n    this._protocol.on('enqueue', this._handleProtocolEnqueue.bind(this));\n    if (this.config.connectTimeout) {\n      var handleConnectTimeout = this._handleConnectTimeout.bind(this);\n      this._socket.setTimeout(this.config.connectTimeout, handleConnectTimeout);\n      this._socket.once('connect', function () {\n        this.setTimeout(0, handleConnectTimeout);\n      });\n    }\n  }\n  this._protocol.handshake(options, wrapCallbackInDomain(this, callback));\n};\nConnection.prototype.changeUser = function changeUser(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n  this._implyConnect();\n  var charsetNumber = options.charset ? ConnectionConfig.getCharsetNumber(options.charset) : this.config.charsetNumber;\n  return this._protocol.changeUser({\n    user: options.user || this.config.user,\n    password: options.password || this.config.password,\n    database: options.database || this.config.database,\n    timeout: options.timeout,\n    charsetNumber: charsetNumber,\n    currentConfig: this.config\n  }, wrapCallbackInDomain(this, callback));\n};\nConnection.prototype.beginTransaction = function beginTransaction(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n  options = options || {};\n  options.sql = 'START TRANSACTION';\n  options.values = null;\n  return this.query(options, callback);\n};\nConnection.prototype.commit = function commit(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n  options = options || {};\n  options.sql = 'COMMIT';\n  options.values = null;\n  return this.query(options, callback);\n};\nConnection.prototype.rollback = function rollback(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n  options = options || {};\n  options.sql = 'ROLLBACK';\n  options.values = null;\n  return this.query(options, callback);\n};\nConnection.prototype.query = function query(sql, values, cb) {\n  var query = Connection.createQuery(sql, values, cb);\n  query._connection = this;\n  if (!(typeof sql === 'object' && 'typeCast' in sql)) {\n    query.typeCast = this.config.typeCast;\n  }\n  if (query.sql) {\n    query.sql = this.format(query.sql, query.values);\n  }\n  if (query._callback) {\n    query._callback = wrapCallbackInDomain(this, query._callback);\n  }\n  this._implyConnect();\n  return this._protocol._enqueue(query);\n};\nConnection.prototype.ping = function ping(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n  this._implyConnect();\n  this._protocol.ping(options, wrapCallbackInDomain(this, callback));\n};\nConnection.prototype.statistics = function statistics(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n  this._implyConnect();\n  this._protocol.stats(options, wrapCallbackInDomain(this, callback));\n};\nConnection.prototype.end = function end(options, callback) {\n  var cb = callback;\n  var opts = options;\n  if (!callback && typeof options === 'function') {\n    cb = options;\n    opts = null;\n  }\n\n  // create custom options reference\n  opts = Object.create(opts || null);\n  if (opts.timeout === undefined) {\n    // default timeout of 30 seconds\n    opts.timeout = 30000;\n  }\n  this._implyConnect();\n  this._protocol.quit(opts, wrapCallbackInDomain(this, cb));\n};\nConnection.prototype.destroy = function () {\n  this.state = 'disconnected';\n  this._implyConnect();\n  this._socket.destroy();\n  this._protocol.destroy();\n};\nConnection.prototype.pause = function () {\n  this._socket.pause();\n  this._protocol.pause();\n};\nConnection.prototype.resume = function () {\n  this._socket.resume();\n  this._protocol.resume();\n};\nConnection.prototype.escape = function (value) {\n  return SqlString.escape(value, false, this.config.timezone);\n};\nConnection.prototype.escapeId = function escapeId(value) {\n  return SqlString.escapeId(value, false);\n};\nConnection.prototype.format = function (sql, values) {\n  if (typeof this.config.queryFormat === 'function') {\n    return this.config.queryFormat.call(this, sql, values, this.config.timezone);\n  }\n  return SqlString.format(sql, values, this.config.stringifyObjects, this.config.timezone);\n};\nif (tls.TLSSocket) {\n  // 0.11+ environment\n  Connection.prototype._startTLS = function _startTLS(onSecure) {\n    var connection = this;\n    createSecureContext(this.config, function (err, secureContext) {\n      if (err) {\n        onSecure(err);\n        return;\n      }\n\n      // \"unpipe\"\n      connection._socket.removeAllListeners('data');\n      connection._protocol.removeAllListeners('data');\n\n      // socket <-> encrypted\n      var rejectUnauthorized = connection.config.ssl.rejectUnauthorized;\n      var secureEstablished = false;\n      var secureSocket = new tls.TLSSocket(connection._socket, {\n        rejectUnauthorized: rejectUnauthorized,\n        requestCert: true,\n        secureContext: secureContext,\n        isServer: false\n      });\n\n      // error handler for secure socket\n      secureSocket.on('_tlsError', function (err) {\n        if (secureEstablished) {\n          connection._handleNetworkError(err);\n        } else {\n          onSecure(err);\n        }\n      });\n\n      // cleartext <-> protocol\n      secureSocket.pipe(connection._protocol);\n      connection._protocol.on('data', function (data) {\n        secureSocket.write(data);\n      });\n      secureSocket.on('secure', function () {\n        secureEstablished = true;\n        onSecure(rejectUnauthorized ? this.ssl.verifyError() : null);\n      });\n\n      // start TLS communications\n      secureSocket._start();\n    });\n  };\n} else {\n  // pre-0.11 environment\n  Connection.prototype._startTLS = function _startTLS(onSecure) {\n    // before TLS:\n    //  _socket <-> _protocol\n    // after:\n    //  _socket <-> securePair.encrypted <-> securePair.cleartext <-> _protocol\n\n    var connection = this;\n    var credentials = Crypto.createCredentials({\n      ca: this.config.ssl.ca,\n      cert: this.config.ssl.cert,\n      ciphers: this.config.ssl.ciphers,\n      key: this.config.ssl.key,\n      passphrase: this.config.ssl.passphrase\n    });\n    var rejectUnauthorized = this.config.ssl.rejectUnauthorized;\n    var secureEstablished = false;\n    var securePair = tls.createSecurePair(credentials, false, true, rejectUnauthorized);\n\n    // error handler for secure pair\n    securePair.on('error', function (err) {\n      if (secureEstablished) {\n        connection._handleNetworkError(err);\n      } else {\n        onSecure(err);\n      }\n    });\n\n    // \"unpipe\"\n    this._socket.removeAllListeners('data');\n    this._protocol.removeAllListeners('data');\n\n    // socket <-> encrypted\n    securePair.encrypted.pipe(this._socket);\n    this._socket.on('data', function (data) {\n      securePair.encrypted.write(data);\n    });\n\n    // cleartext <-> protocol\n    securePair.cleartext.pipe(this._protocol);\n    this._protocol.on('data', function (data) {\n      securePair.cleartext.write(data);\n    });\n\n    // secure established\n    securePair.on('secure', function () {\n      secureEstablished = true;\n      if (!rejectUnauthorized) {\n        onSecure();\n        return;\n      }\n      var verifyError = this.ssl.verifyError();\n      var err = verifyError;\n\n      // node.js 0.6 support\n      if (typeof err === 'string') {\n        err = new Error(verifyError);\n        err.code = verifyError;\n      }\n      onSecure(err);\n    });\n\n    // node.js 0.8 bug\n    securePair._cycle = securePair.cycle;\n    securePair.cycle = function cycle() {\n      if (this.ssl && this.ssl.error) {\n        this.error();\n      }\n      return this._cycle.apply(this, arguments);\n    };\n  };\n}\nConnection.prototype._handleConnectTimeout = function () {\n  if (this._socket) {\n    this._socket.setTimeout(0);\n    this._socket.destroy();\n  }\n  var err = new Error('connect ETIMEDOUT');\n  err.errorno = 'ETIMEDOUT';\n  err.code = 'ETIMEDOUT';\n  err.syscall = 'connect';\n  this._handleNetworkError(err);\n};\nConnection.prototype._handleNetworkError = function (err) {\n  this._protocol.handleNetworkError(err);\n};\nConnection.prototype._handleProtocolError = function (err) {\n  this.state = 'protocol_error';\n  this.emit('error', err);\n};\nConnection.prototype._handleProtocolDrain = function () {\n  this.emit('drain');\n};\nConnection.prototype._handleProtocolConnect = function () {\n  this.state = 'connected';\n  this.emit('connect');\n};\nConnection.prototype._handleProtocolHandshake = function _handleProtocolHandshake() {\n  this.state = 'authenticated';\n};\nConnection.prototype._handleProtocolInitialize = function _handleProtocolInitialize(packet) {\n  this.threadId = packet.threadId;\n};\nConnection.prototype._handleProtocolEnd = function (err) {\n  this.state = 'disconnected';\n  this.emit('end', err);\n};\nConnection.prototype._handleProtocolEnqueue = function _handleProtocolEnqueue(sequence) {\n  this.emit('enqueue', sequence);\n};\nConnection.prototype._implyConnect = function () {\n  if (!this._connectCalled) {\n    this.connect();\n  }\n};\nfunction createSecureContext(config, cb) {\n  var context = null;\n  var error = null;\n  try {\n    context = tls.createSecureContext({\n      ca: config.ssl.ca,\n      cert: config.ssl.cert,\n      ciphers: config.ssl.ciphers,\n      key: config.ssl.key,\n      passphrase: config.ssl.passphrase\n    });\n  } catch (err) {\n    error = err;\n  }\n  cb(error, context);\n}\nfunction unwrapFromDomain(fn) {\n  return function () {\n    var domains = [];\n    var ret;\n    while (process.domain) {\n      domains.shift(process.domain);\n      process.domain.exit();\n    }\n    try {\n      ret = fn.apply(this, arguments);\n    } finally {\n      for (var i = 0; i < domains.length; i++) {\n        domains[i].enter();\n      }\n    }\n    return ret;\n  };\n}\nfunction wrapCallbackInDomain(ee, fn) {\n  if (typeof fn !== 'function') {\n    return undefined;\n  }\n  if (fn.domain) {\n    return fn;\n  }\n  var domain = process.domain;\n  if (domain) {\n    return domain.bind(fn);\n  } else if (ee) {\n    return unwrapFromDomain(wrapToDomain(ee, fn));\n  } else {\n    return fn;\n  }\n}\nfunction wrapToDomain(ee, fn) {\n  return function () {\n    if (Events.usingDomains && ee.domain) {\n      ee.domain.enter();\n      fn.apply(this, arguments);\n      ee.domain.exit();\n    } else {\n      fn.apply(this, arguments);\n    }\n  };\n}","map":{"version":3,"names":["Crypto","require","Events","Net","tls","ConnectionConfig","Protocol","SqlString","Query","Util","module","exports","Connection","inherits","EventEmitter","options","call","config","_socket","socket","_protocol","connection","_connectCalled","state","threadId","createQuery","sql","values","callback","cb","Object","create","undefined","defineProperty","value","wrapCallbackInDomain","TypeError","prototype","connect","socketPath","createConnection","port","host","usingDomains","domain","on","data","write","wrapToDomain","end","_handleNetworkError","bind","_handleProtocolConnect","_handleProtocolHandshake","_handleProtocolInitialize","_handleProtocolError","_handleProtocolDrain","_handleProtocolEnd","_handleProtocolEnqueue","connectTimeout","handleConnectTimeout","_handleConnectTimeout","setTimeout","once","handshake","changeUser","_implyConnect","charsetNumber","charset","getCharsetNumber","user","password","database","timeout","currentConfig","beginTransaction","query","commit","rollback","_connection","typeCast","format","_callback","_enqueue","ping","statistics","stats","opts","quit","destroy","pause","resume","escape","timezone","escapeId","queryFormat","stringifyObjects","TLSSocket","_startTLS","onSecure","createSecureContext","err","secureContext","removeAllListeners","rejectUnauthorized","ssl","secureEstablished","secureSocket","requestCert","isServer","pipe","verifyError","_start","credentials","createCredentials","ca","cert","ciphers","key","passphrase","securePair","createSecurePair","encrypted","cleartext","Error","code","_cycle","cycle","error","apply","arguments","errorno","syscall","handleNetworkError","emit","packet","sequence","context","unwrapFromDomain","fn","domains","ret","process","shift","exit","i","length","enter","ee"],"sources":["D:/BNH/vizsgaremek/node_modules/mysql/lib/Connection.js"],"sourcesContent":["var Crypto           = require('crypto');\nvar Events           = require('events');\nvar Net              = require('net');\nvar tls              = require('tls');\nvar ConnectionConfig = require('./ConnectionConfig');\nvar Protocol         = require('./protocol/Protocol');\nvar SqlString        = require('./protocol/SqlString');\nvar Query            = require('./protocol/sequences/Query');\nvar Util             = require('util');\n\nmodule.exports = Connection;\nUtil.inherits(Connection, Events.EventEmitter);\nfunction Connection(options) {\n  Events.EventEmitter.call(this);\n\n  this.config = options.config;\n\n  this._socket        = options.socket;\n  this._protocol      = new Protocol({config: this.config, connection: this});\n  this._connectCalled = false;\n  this.state          = 'disconnected';\n  this.threadId       = null;\n}\n\nConnection.createQuery = function createQuery(sql, values, callback) {\n  if (sql instanceof Query) {\n    return sql;\n  }\n\n  var cb      = callback;\n  var options = {};\n\n  if (typeof sql === 'function') {\n    cb = sql;\n  } else if (typeof sql === 'object') {\n    options = Object.create(sql);\n\n    if (typeof values === 'function') {\n      cb = values;\n    } else if (values !== undefined) {\n      Object.defineProperty(options, 'values', { value: values });\n    }\n  } else {\n    options.sql = sql;\n\n    if (typeof values === 'function') {\n      cb = values;\n    } else if (values !== undefined) {\n      options.values = values;\n    }\n  }\n\n  if (cb !== undefined) {\n    cb = wrapCallbackInDomain(null, cb);\n\n    if (cb === undefined) {\n      throw new TypeError('argument callback must be a function when provided');\n    }\n  }\n\n  return new Query(options, cb);\n};\n\nConnection.prototype.connect = function connect(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  if (!this._connectCalled) {\n    this._connectCalled = true;\n\n    // Connect either via a UNIX domain socket or a TCP socket.\n    this._socket = (this.config.socketPath)\n      ? Net.createConnection(this.config.socketPath)\n      : Net.createConnection(this.config.port, this.config.host);\n\n    // Connect socket to connection domain\n    if (Events.usingDomains) {\n      this._socket.domain = this.domain;\n    }\n\n    var connection = this;\n    this._protocol.on('data', function(data) {\n      connection._socket.write(data);\n    });\n    this._socket.on('data', wrapToDomain(connection, function (data) {\n      connection._protocol.write(data);\n    }));\n    this._protocol.on('end', function() {\n      connection._socket.end();\n    });\n    this._socket.on('end', wrapToDomain(connection, function () {\n      connection._protocol.end();\n    }));\n\n    this._socket.on('error', this._handleNetworkError.bind(this));\n    this._socket.on('connect', this._handleProtocolConnect.bind(this));\n    this._protocol.on('handshake', this._handleProtocolHandshake.bind(this));\n    this._protocol.on('initialize', this._handleProtocolInitialize.bind(this));\n    this._protocol.on('unhandledError', this._handleProtocolError.bind(this));\n    this._protocol.on('drain', this._handleProtocolDrain.bind(this));\n    this._protocol.on('end', this._handleProtocolEnd.bind(this));\n    this._protocol.on('enqueue', this._handleProtocolEnqueue.bind(this));\n\n    if (this.config.connectTimeout) {\n      var handleConnectTimeout = this._handleConnectTimeout.bind(this);\n\n      this._socket.setTimeout(this.config.connectTimeout, handleConnectTimeout);\n      this._socket.once('connect', function() {\n        this.setTimeout(0, handleConnectTimeout);\n      });\n    }\n  }\n\n  this._protocol.handshake(options, wrapCallbackInDomain(this, callback));\n};\n\nConnection.prototype.changeUser = function changeUser(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  this._implyConnect();\n\n  var charsetNumber = (options.charset)\n    ? ConnectionConfig.getCharsetNumber(options.charset)\n    : this.config.charsetNumber;\n\n  return this._protocol.changeUser({\n    user          : options.user || this.config.user,\n    password      : options.password || this.config.password,\n    database      : options.database || this.config.database,\n    timeout       : options.timeout,\n    charsetNumber : charsetNumber,\n    currentConfig : this.config\n  }, wrapCallbackInDomain(this, callback));\n};\n\nConnection.prototype.beginTransaction = function beginTransaction(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  options = options || {};\n  options.sql = 'START TRANSACTION';\n  options.values = null;\n\n  return this.query(options, callback);\n};\n\nConnection.prototype.commit = function commit(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  options = options || {};\n  options.sql = 'COMMIT';\n  options.values = null;\n\n  return this.query(options, callback);\n};\n\nConnection.prototype.rollback = function rollback(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  options = options || {};\n  options.sql = 'ROLLBACK';\n  options.values = null;\n\n  return this.query(options, callback);\n};\n\nConnection.prototype.query = function query(sql, values, cb) {\n  var query = Connection.createQuery(sql, values, cb);\n  query._connection = this;\n\n  if (!(typeof sql === 'object' && 'typeCast' in sql)) {\n    query.typeCast = this.config.typeCast;\n  }\n\n  if (query.sql) {\n    query.sql = this.format(query.sql, query.values);\n  }\n\n  if (query._callback) {\n    query._callback = wrapCallbackInDomain(this, query._callback);\n  }\n\n  this._implyConnect();\n\n  return this._protocol._enqueue(query);\n};\n\nConnection.prototype.ping = function ping(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  this._implyConnect();\n  this._protocol.ping(options, wrapCallbackInDomain(this, callback));\n};\n\nConnection.prototype.statistics = function statistics(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  this._implyConnect();\n  this._protocol.stats(options, wrapCallbackInDomain(this, callback));\n};\n\nConnection.prototype.end = function end(options, callback) {\n  var cb   = callback;\n  var opts = options;\n\n  if (!callback && typeof options === 'function') {\n    cb   = options;\n    opts = null;\n  }\n\n  // create custom options reference\n  opts = Object.create(opts || null);\n\n  if (opts.timeout === undefined) {\n    // default timeout of 30 seconds\n    opts.timeout = 30000;\n  }\n\n  this._implyConnect();\n  this._protocol.quit(opts, wrapCallbackInDomain(this, cb));\n};\n\nConnection.prototype.destroy = function() {\n  this.state = 'disconnected';\n  this._implyConnect();\n  this._socket.destroy();\n  this._protocol.destroy();\n};\n\nConnection.prototype.pause = function() {\n  this._socket.pause();\n  this._protocol.pause();\n};\n\nConnection.prototype.resume = function() {\n  this._socket.resume();\n  this._protocol.resume();\n};\n\nConnection.prototype.escape = function(value) {\n  return SqlString.escape(value, false, this.config.timezone);\n};\n\nConnection.prototype.escapeId = function escapeId(value) {\n  return SqlString.escapeId(value, false);\n};\n\nConnection.prototype.format = function(sql, values) {\n  if (typeof this.config.queryFormat === 'function') {\n    return this.config.queryFormat.call(this, sql, values, this.config.timezone);\n  }\n  return SqlString.format(sql, values, this.config.stringifyObjects, this.config.timezone);\n};\n\nif (tls.TLSSocket) {\n  // 0.11+ environment\n  Connection.prototype._startTLS = function _startTLS(onSecure) {\n    var connection = this;\n\n    createSecureContext(this.config, function (err, secureContext) {\n      if (err) {\n        onSecure(err);\n        return;\n      }\n\n      // \"unpipe\"\n      connection._socket.removeAllListeners('data');\n      connection._protocol.removeAllListeners('data');\n\n      // socket <-> encrypted\n      var rejectUnauthorized = connection.config.ssl.rejectUnauthorized;\n      var secureEstablished  = false;\n      var secureSocket       = new tls.TLSSocket(connection._socket, {\n        rejectUnauthorized : rejectUnauthorized,\n        requestCert        : true,\n        secureContext      : secureContext,\n        isServer           : false\n      });\n\n      // error handler for secure socket\n      secureSocket.on('_tlsError', function(err) {\n        if (secureEstablished) {\n          connection._handleNetworkError(err);\n        } else {\n          onSecure(err);\n        }\n      });\n\n      // cleartext <-> protocol\n      secureSocket.pipe(connection._protocol);\n      connection._protocol.on('data', function(data) {\n        secureSocket.write(data);\n      });\n\n      secureSocket.on('secure', function() {\n        secureEstablished = true;\n\n        onSecure(rejectUnauthorized ? this.ssl.verifyError() : null);\n      });\n\n      // start TLS communications\n      secureSocket._start();\n    });\n  };\n} else {\n  // pre-0.11 environment\n  Connection.prototype._startTLS = function _startTLS(onSecure) {\n    // before TLS:\n    //  _socket <-> _protocol\n    // after:\n    //  _socket <-> securePair.encrypted <-> securePair.cleartext <-> _protocol\n\n    var connection  = this;\n    var credentials = Crypto.createCredentials({\n      ca         : this.config.ssl.ca,\n      cert       : this.config.ssl.cert,\n      ciphers    : this.config.ssl.ciphers,\n      key        : this.config.ssl.key,\n      passphrase : this.config.ssl.passphrase\n    });\n\n    var rejectUnauthorized = this.config.ssl.rejectUnauthorized;\n    var secureEstablished  = false;\n    var securePair         = tls.createSecurePair(credentials, false, true, rejectUnauthorized);\n\n    // error handler for secure pair\n    securePair.on('error', function(err) {\n      if (secureEstablished) {\n        connection._handleNetworkError(err);\n      } else {\n        onSecure(err);\n      }\n    });\n\n    // \"unpipe\"\n    this._socket.removeAllListeners('data');\n    this._protocol.removeAllListeners('data');\n\n    // socket <-> encrypted\n    securePair.encrypted.pipe(this._socket);\n    this._socket.on('data', function(data) {\n      securePair.encrypted.write(data);\n    });\n\n    // cleartext <-> protocol\n    securePair.cleartext.pipe(this._protocol);\n    this._protocol.on('data', function(data) {\n      securePair.cleartext.write(data);\n    });\n\n    // secure established\n    securePair.on('secure', function() {\n      secureEstablished = true;\n\n      if (!rejectUnauthorized) {\n        onSecure();\n        return;\n      }\n\n      var verifyError = this.ssl.verifyError();\n      var err = verifyError;\n\n      // node.js 0.6 support\n      if (typeof err === 'string') {\n        err = new Error(verifyError);\n        err.code = verifyError;\n      }\n\n      onSecure(err);\n    });\n\n    // node.js 0.8 bug\n    securePair._cycle = securePair.cycle;\n    securePair.cycle  = function cycle() {\n      if (this.ssl && this.ssl.error) {\n        this.error();\n      }\n\n      return this._cycle.apply(this, arguments);\n    };\n  };\n}\n\nConnection.prototype._handleConnectTimeout = function() {\n  if (this._socket) {\n    this._socket.setTimeout(0);\n    this._socket.destroy();\n  }\n\n  var err = new Error('connect ETIMEDOUT');\n  err.errorno = 'ETIMEDOUT';\n  err.code = 'ETIMEDOUT';\n  err.syscall = 'connect';\n\n  this._handleNetworkError(err);\n};\n\nConnection.prototype._handleNetworkError = function(err) {\n  this._protocol.handleNetworkError(err);\n};\n\nConnection.prototype._handleProtocolError = function(err) {\n  this.state = 'protocol_error';\n  this.emit('error', err);\n};\n\nConnection.prototype._handleProtocolDrain = function() {\n  this.emit('drain');\n};\n\nConnection.prototype._handleProtocolConnect = function() {\n  this.state = 'connected';\n  this.emit('connect');\n};\n\nConnection.prototype._handleProtocolHandshake = function _handleProtocolHandshake() {\n  this.state = 'authenticated';\n};\n\nConnection.prototype._handleProtocolInitialize = function _handleProtocolInitialize(packet) {\n  this.threadId = packet.threadId;\n};\n\nConnection.prototype._handleProtocolEnd = function(err) {\n  this.state = 'disconnected';\n  this.emit('end', err);\n};\n\nConnection.prototype._handleProtocolEnqueue = function _handleProtocolEnqueue(sequence) {\n  this.emit('enqueue', sequence);\n};\n\nConnection.prototype._implyConnect = function() {\n  if (!this._connectCalled) {\n    this.connect();\n  }\n};\n\nfunction createSecureContext (config, cb) {\n  var context = null;\n  var error   = null;\n\n  try {\n    context = tls.createSecureContext({\n      ca         : config.ssl.ca,\n      cert       : config.ssl.cert,\n      ciphers    : config.ssl.ciphers,\n      key        : config.ssl.key,\n      passphrase : config.ssl.passphrase\n    });\n  } catch (err) {\n    error = err;\n  }\n\n  cb(error, context);\n}\n\nfunction unwrapFromDomain(fn) {\n  return function () {\n    var domains = [];\n    var ret;\n\n    while (process.domain) {\n      domains.shift(process.domain);\n      process.domain.exit();\n    }\n\n    try {\n      ret = fn.apply(this, arguments);\n    } finally {\n      for (var i = 0; i < domains.length; i++) {\n        domains[i].enter();\n      }\n    }\n\n    return ret;\n  };\n}\n\nfunction wrapCallbackInDomain(ee, fn) {\n  if (typeof fn !== 'function') {\n    return undefined;\n  }\n\n  if (fn.domain) {\n    return fn;\n  }\n\n  var domain = process.domain;\n\n  if (domain) {\n    return domain.bind(fn);\n  } else if (ee) {\n    return unwrapFromDomain(wrapToDomain(ee, fn));\n  } else {\n    return fn;\n  }\n}\n\nfunction wrapToDomain(ee, fn) {\n  return function () {\n    if (Events.usingDomains && ee.domain) {\n      ee.domain.enter();\n      fn.apply(this, arguments);\n      ee.domain.exit();\n    } else {\n      fn.apply(this, arguments);\n    }\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}